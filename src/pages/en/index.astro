---
import MainLayout from "../../layouts/MainLayout.astro";
import data from "../../data/progress.json";
---

<MainLayout title="The Slow Road Back | Home">
  <div
    transition:name="hero-card"
    class="m-4 md:m-8 lg:m-12 p-6 md:p-8 lg:p-10 bg-gray-900 bg-opacity-70 rounded-xl backdrop-blur-sm text-center text-white max-w-5xl mx-auto"
  >
    <h1 class="font-display font-extrabold text-4xl md:text-5xl lg:text-6xl">
      The Slow Road Back
    </h1>

    <p class="font-display text-2xl md:text-4xl font-bold text-brand-blue mt-4">
      #RIDING4GBS
    </p>

    <div id="countdown" class="my-8 font-sans" data-target-date={data.targetDate}>
      <div id="cd-display" class="flex justify-center items-center gap-2 md:gap-4"></div>
      <p id="cd-message" class="text-lg mt-2 text-gray-300"></p>
    </div>

    <div class="font-sans text-lg max-w-3xl mx-auto space-y-6 mt-8 text-left">
      <p>
        My name is Martin, and I am a survivor of Guillain-Barré Syndrome (GBS). My recovery taught me that the journey is more important than the destination. This is my <strong>Slow Road Back</strong>.
      </p>
      <p>
        <strong>On September 30th, 2026</strong>, I will begin a deeply personal cycling challenge, starting from my home in Pamplona. My goal is to ride into the heart of the Pyrenees, to traverse the mountains from the Atlantic coast to the Mediterranean, and to see how far this journey of recovery and resilience will take me.
      </p>
      <p>
        This ride is a mission to raise vital awareness and funds for the GBS community. I don't know exactly how many days it will take, or how many mountains I'll have to climb. But I invite you to follow along, day by day, on this journey of hope and resilience.
      </p>

      <div class="mt-8 md:mt-12">
        <p class="font-sans font-bold text-center">In proud partnership with</p>
        <div class="mt-4 flex flex-col md:flex-row justify-center items-center gap-6 md:gap-8">
          <a href="#" class="group relative flex flex-col items-center justify-between gap-4 p-6 bg-white rounded-lg h-40 w-64 transition-transform hover:scale-105">
            <img src="/logos/INUK-Wordmark-Logo_RGB.png" alt="Inflammatory Neuropathies UK" class="max-h-16 object-contain" />
            <div class="font-sans bg-gray-100 text-gray-800 px-6 py-2 rounded-md">
              Visit Website
            </div>
            <div class="absolute inset-0 bg-black/80 text-white flex items-center justify-center p-4 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="font-sans font-bold">Inflammatory Neuropathies UK</p>
            </div>
          </a>
          <a href="#" class="group relative flex flex-col items-center justify-between gap-4 p-6 bg-white rounded-lg h-40 w-64 transition-transform hover:scale-105">
            <img src="/logos/GBS-CIDP_neuropatias-RC-3.png" alt="GBS|CIDP España" class="max-h-16 object-contain" />
            <div class="font-sans bg-gray-100 text-gray-800 px-6 py-2 rounded-md">
              Visita el sitio web
            </div>
            <div class="absolute inset-0 bg-black/80 text-white flex items-center justify-center p-4 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="font-sans font-bold">GBS|CIDP España</p>
            </div>
          </a>
          <a href="#" class="group relative flex flex-col items-center justify-between gap-4 p-6 bg-white rounded-lg h-40 w-64 transition-transform hover:scale-105">
            <img src="/logos/fr.jpg" alt="Association Française du Syndrome de Guillain-Barré" class="max-h-16 object-contain" />
            <div class="font-sans bg-gray-100 text-gray-800 px-6 py-2 rounded-md">
              Visiter le site web
            </div>
            <div class="absolute inset-0 bg-black/80 text-white flex items-center justify-center p-4 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="font-sans font-bold text-center">
                Association Française du Syndrome de Guillain-Barré
              </p>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</MainLayout>

<script>
  declare global {
    interface Window {
      countdownTimer?: NodeJS.Timeout | number;
    }
  }
  document.addEventListener("astro:page-load", function () {
    const countdownContainer = document.getElementById("countdown") as HTMLElement | null;
    if (!countdownContainer) return;

    const targetDateString = countdownContainer.dataset.targetDate;
    if (!targetDateString) return;

    const TARGET_DATE = new Date(targetDateString);
    const lang = document.documentElement.lang.startsWith("es") ? "es" : "en";
    const i18n = {
      en: { begins: (dateStr: string) => `The challenge begins on ${dateStr}`, underway: "The ride is underway! Follow the progress.", units: { year: ["Year", "Years"] as const, day: ["Day", "Days"] as const, hour: ["Hour", "Hours"] as const, minute: ["Minute", "Minutes"] as const, second: ["Second", "Seconds"] as const, }, dateLocale: "en-GB", },
      es: { begins: (dateStr: string) => `El reto comienza el ${dateStr}`, underway: "¡La ruta está en marcha! Sigue el progreso.", units: { year: ["Año", "Años"] as const, day: ["Día", "Días"] as const, hour: ["Hora", "Horas"] as const, minute: ["Minuto", "Minutos"] as const, second: ["Segundo", "Segundos"] as const, }, dateLocale: "es-ES", },
    }[lang];

    const displayEl = document.getElementById("cd-display") as HTMLElement;
    const msgEl = document.getElementById("cd-message") as HTMLElement;

    if (!displayEl || !msgEl) return;

    if (window.countdownTimer) {
      clearInterval(window.countdownTimer);
    }

    function updateCountdown() {
      const now = new Date();
      const diff = TARGET_DATE.getTime() - now.getTime();
      if (diff <= 0) {
        msgEl.classList.remove("hidden");
        msgEl.textContent = i18n.underway;
        countdownContainer.innerHTML = "";
        clearInterval(window.countdownTimer);
        return;
      }
      let days = Math.floor(diff / (1000 * 60 * 60 * 24));
      let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      let seconds = Math.floor((diff % (1000 * 60)) / 1000);
      const years = Math.floor(days / 365);
      days %= 365;

      const label = (units: readonly [string, string], n: number) => n === 1 ? units[0] : units[1];
      const parts: string[] = [];
      if (years > 0) parts.push(`<div class="text-center"><div class="font-bold text-2xl md:text-3xl">${years}</div><div class="text-xs">${label(i18n.units.year, years)}</div></div>`);
      if (days > 0 || years > 0) parts.push(`<div class="text-center"><div class="font-bold text-2xl md:text-3xl">${days}</div><div class="text-xs">${label(i18n.units.day, days)}</div></div>`);
      if (hours > 0 || days > 0 || years > 0) parts.push(`<div class="text-center"><div class="font-bold text-2xl md:text-3xl">${hours}</div><div class="text-xs">${label(i18n.units.hour, hours)}</div></div>`);
      parts.push(`<div class="text-center"><div class="font-bold text-2xl md:text-3xl">${minutes}</div><div class="text-xs">${label(i18n.units.minute, minutes)}</div></div>`);
      parts.push(`<div class="text-center"><div class="font-bold text-2xl md:text-3xl">${seconds}</div><div class="text-xs">${label(i18n.units.second, seconds)}</div></div>`);
      displayEl.innerHTML = parts.join('<div class="text-2xl md:text-3xl font-bold">:</div>');
      const targetLocaleString = TARGET_DATE.toLocaleString(i18n.dateLocale, { day: '2-digit', month: 'long', year: 'numeric', timeZone: "Europe/Madrid" });
      msgEl.textContent = i18n.begins(targetLocaleString);
    }

    updateCountdown();
    window.countdownTimer = setInterval(updateCountdown, 1000);
  });
</script>