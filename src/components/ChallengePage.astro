---
import MainLayout from "../layouts/MainLayout.astro";
import type { ChallengeLocaleContent } from "../data/challenge.i18n";
import { marked } from "marked";

export interface Props {
  lang: "en" | "es" | "fr";
  t: ChallengeLocaleContent;
  tEu?: ChallengeLocaleContent;
}

const { t, tEu } = Astro.props as Props;
---

<MainLayout title={t.metaTitle}>
  <div
    transition:name="challenge-card"
    class="page-card-dark max-w-6xl w-full mx-auto font-body"
  >
    <div class="text-center">
      <h1 class="hero-title text-white" data-lang={Astro.props.lang}>
        {t.heroTitle}
      </h1>
      {
        tEu && (
          <h1 class="hero-title text-white hidden" data-lang="eu">
            {tEu.heroTitle}
          </h1>
        )
      }

      <div
        class="mt-4 max-w-2xl mx-auto font-body text-left text-base md:text-lg lg:text-xl text-gray-300"
        data-lang={Astro.props.lang}
        set:html={marked.parse(t.heroDescriptionMd)}
      />
      {
        tEu && (
          <div
            class="mt-4 max-w-2xl mx-auto font-body text-left text-base md:text-lg lg:text-xl text-gray-300 hidden"
            data-lang="eu"
            set:html={marked.parse(tEu.heroDescriptionMd)}
          />
        )
      }
    </div>

    <div class="max-w-3xl mx-auto my-10 md:my-12 bg-gray-50 p-6 rounded-lg">
      <div
        class="challenge-values grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 text-center"
        data-lang={Astro.props.lang}
      >
        {
          t.stats.map((s) => (
            <div>
              <p class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-brand-blue">
                {s.value}
              </p>
              <p class="text-sm text-gray-700">{s.label}</p>
            </div>
          ))
        }
      </div>
      {
        tEu && (
          <div
            class="challenge-values grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 text-center hidden"
            data-lang="eu"
          >
            {tEu.stats.map((s) => (
              <div>
                <p class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-brand-blue">
                  {s.value}
                </p>
                <p class="text-sm text-gray-700">{s.label}</p>
              </div>
            ))}
          </div>
        )
      }
    </div>

    <div class="bg-gray-50 p-6 rounded-lg max-w-3xl mx-auto">
      <h2
        class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-gray-900"
        data-lang={Astro.props.lang}
      >
        {t.styleHeading}
      </h2>
      {
        tEu && (
          <h2
            class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-gray-900 hidden"
            data-lang="eu"
          >
            {tEu.styleHeading}
          </h2>
        )
      }

      <div
        class="mt-2 font-body text-base md:text-lg lg:text-xl text-gray-600"
        data-lang={Astro.props.lang}
        set:html={marked.parse(t.styleBodyMd)}
      />
      {
        tEu && (
          <div
            class="mt-2 font-body text-base md:text-lg lg:text-xl text-gray-600 hidden"
            data-lang="eu"
            set:html={marked.parse(tEu.styleBodyMd)}
          />
        )
      }
    </div>

    <div class="grid md:grid-cols-2 gap-8 mt-12">
      {
        t.legs.map((leg, index) => (
          <div class="bg-gray-50 p-6 rounded-lg">
            <h3
              class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-gray-900"
              data-lang={Astro.props.lang}
            >
              {leg.title}
            </h3>
            {tEu && tEu.legs[index] && (
              <h3
                class="font-headline font-semibold text-lg md:text-xl lg:text-2xl text-gray-900 hidden"
                data-lang="eu"
              >
                {tEu.legs[index].title}
              </h3>
            )}

            <div
              class="mt-2 font-body text-base md:text-lg lg:text-xl text-gray-600"
              data-lang={Astro.props.lang}
              set:html={marked.parse(leg.bodyMd)}
            />
            {tEu && tEu.legs[index] && (
              <div
                class="mt-2 font-body text-base md:text-lg lg:text-xl text-gray-600 hidden"
                data-lang="eu"
                set:html={marked.parse(tEu.legs[index].bodyMd)}
              />
            )}
          </div>
        ))
      }
    </div>
  </div>
</MainLayout>

<script>
  import { readStoredLanguage } from "../utils/language";

  async function updateLanguage() {
    const lang = await readStoredLanguage();
    const baseLang = document
      .querySelector('h1.hero-title[data-lang]:not([data-lang="eu"])')
      ?.getAttribute("data-lang");

    if (baseLang) {
      const elements = document.querySelectorAll("[data-lang]");
      elements.forEach((el) => {
        const elLang = el.getAttribute("data-lang");
        if (lang === "eu") {
          if (elLang === "eu") el.classList.remove("hidden");
          if (elLang === baseLang) el.classList.add("hidden");
        } else {
          if (elLang === "eu") el.classList.add("hidden");
          if (elLang === baseLang) el.classList.remove("hidden");
        }
      });
    }
  }

  updateLanguage();
  document.addEventListener("language-change", updateLanguage);
</script>
