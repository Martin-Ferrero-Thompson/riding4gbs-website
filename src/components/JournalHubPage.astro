---
import MainLayout from "../layouts/MainLayout.astro";
import type { JournalHubLocaleContent } from "../data/journalHub.i18n";
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

export interface Props {
  lang: 'en' | 'es' | 'fr';
  t: JournalHubLocaleContent;
}

const { lang, t } = Astro.props as Props;

const allPosts = await getCollection('posts', ({ id }) => id.startsWith(`${lang}/`));
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const featuredPosts = sortedPosts.filter(post => post.data.featured);
const regularPosts = sortedPosts.filter(post => !post.data.featured);

const featuredDateFormat: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
const listDateFormat: Intl.DateTimeFormatOptions = { month: 'long', day: 'numeric' };
---
<MainLayout title={t.metaTitle}>
  <div 
    transition:name="journal-hub-card"
    class="m-4 md:m-8 lg:m-12 p-6 md:p-8 lg:p-10 bg-white rounded-xl max-w-6xl w-full mx-auto text-gray-800 font-sans pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]"
  >
    <div class="text-center">
      <h1 class="font-display font-extrabold text-4xl md:text-5xl lg:text-6xl text-gray-900">
        {t.heroTitle}
      </h1>
      <p class="mt-3 md:mt-4 max-w-3xl mx-auto text-center text-base md:text-lg text-gray-500">
        {t.heroSubtitle}
      </p>
    </div>

    {featuredPosts.length > 0 && (
      <div class="mt-10 md:mt-12">
        <h2 class="font-display font-bold text-3xl md:text-4xl border-b border-gray-200 pb-2 mb-6">{t.featuredHeading}</h2>
        {featuredPosts.map(post => (
          <a href={`/${lang}/posts/${post.slug}/`} class="block group">
            <div class="relative rounded-lg overflow-hidden">
              {post.data.image && <Image src={post.data.image.src} alt={post.data.image.alt} class="w-full h-64 md:h-96 object-cover md:group-hover:scale-105 transition-transform duration-300" widths={[400, 800, 1200]} sizes="100vw" />}
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
              <div class="absolute bottom-0 left-0 p-6 md:p-8 text-white">
                <p class="text-xs md:text-sm font-semibold">{new Date(post.data.pubDate).toLocaleDateString(t.dates.featuredLocale, featuredDateFormat)}</p>
                <h3 class="font-display font-bold text-2xl md:text-4xl mt-2 md:mt-3 group-hover:text-blue-400 transition-colors">{post.data.title}</h3>
                <p class="mt-1 md:mt-2 text-sm md:text-base opacity-90">{post.data.tagline}</p>
              </div>
            </div>
          </a>
        ))}
      </div>
    )}

    <div class="mt-10 md:mt-12">
      <h2 class="font-display font-bold text-3xl md:text-4xl border-b border-gray-200 pb-2 mb-6">{t.latestHeading}</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
        {regularPosts.map(post => (
          <a href={`/${lang}/posts/${post.slug}/`} class="block group">
            <div class="overflow-hidden rounded-lg">
              {post.data.image ? (
                <Image src={post.data.image.src} alt={post.data.image.alt} class="w-full h-40 md:h-48 object-cover md:group-hover:scale-105 transition-transform duration-300" widths={[200, 400]} sizes="(max-width: 768px) 100vw, 400px" />
              ) : (
                <div class="w-full h-40 md:h-48 bg-gray-200"></div>
              )}
            </div>
            <div class="p-3 md:p-4">
              <p class="text-xs md:text-sm font-semibold text-gray-500">{new Date(post.data.pubDate).toLocaleDateString(t.dates.listLocale, listDateFormat)}</p>
              <h3 class="font-display font-bold text-lg md:text-xl mt-1 text-brand-blue group-hover:underline">{post.data.title}</h3>
            </div>
          </a>
        ))}
      </div>
    </div>
  </div>
</MainLayout>
