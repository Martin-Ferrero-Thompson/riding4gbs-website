---
import progressData from '../data/progress.json';
import i18n from '../data/sidebar.json';

// Detect current language from URL
const currentPath = Astro.url.pathname;
const lang = currentPath.startsWith('/es') ? 'es' : currentPath.startsWith('/fr') ? 'fr' : 'en';
const t = i18n[lang]; // 't' is a common shorthand for "translations"

// Format currency for display
const gbpFormatter = new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP', minimumFractionDigits: 0 });
const eurFormatter = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 });
---

<aside id="sidebar" class="bg-gray-900 bg-opacity-90 text-white p-6 flex flex-col min-h-screen w-72 hidden md:flex absolute md:relative z-40">
  <div class="logo mb-8">
    <a href={`/${lang}`} class="text-3xl font-bold text-brand-blue font-display">Riding4GBS</a>
    <p class="text-sm text-gray-400 font-sans">#RIDING4GBS</p>
  </div>

  <div class="mb-8 font-sans">
    <a href={`/${lang}/donate`} class="block w-full text-center bg-brand-teal hover:bg-teal-600 p-3 rounded-lg font-bold transition-colors">
      {t.donateNow}
    </a>
  </div>

  <div class="bg-gray-800 rounded-lg p-4 text-center font-sans mb-8">
    <p class="text-sm font-bold text-gray-300 mb-2">{t.totalRaised}</p>
    <div class="space-y-2">
      <div>
        <span class="text-2xl font-bold text-blue-400">{gbpFormatter.format(progressData.funds_gbp.current)}</span>
        <span class="text-xs text-gray-400"> (UK)</span>
      </div>
      <div>
        <span class="text-2xl font-bold text-blue-400">{eurFormatter.format(progressData.funds_eur.current)}</span>
        <span class="text-xs text-gray-400"> (España)</span>
      </div>
    </div>
  </div>

  <nav class="flex flex-col space-y-4 font-sans">
    <a href={`/${lang}/about-challenge`} class="hover:text-blue-400 transition-colors">{t.challenge}</a>
    <a href={`/${lang}/my-story`} class="hover:text-blue-400 transition-colors">{t.myStory}</a>
    <a href={`/${lang}/about-gbs`} class="hover:text-blue-400 transition-colors">{t.aboutGBS}</a>
    <a href={`/${lang}/my-progress`} class="hover:text-blue-400 transition-colors">{t.myProgress}</a>
    <a href={`/${lang}/daily-ride-diary`} class="hover:text-blue-400 transition-colors">{t.dailyDiary}</a>
    <a href={`/${lang}/partners`} class="hover:text-blue-400 transition-colors">{t.partners}</a>
    <a href={`/${lang}/support-me`} class="hover:text-blue-400 transition-colors">{t.supportMe}</a>
  </nav>

  <div class="mt-12">
    <h3 class="font-display text-sm font-bold text-gray-400 uppercase tracking-wider">{t.followJourney}</h3>
    <div class="mt-4 space-y-2">
      </div>
  </div>

  <footer class="mt-auto pt-8 text-sm text-gray-400 font-sans">
    <div class="flex items-center space-x-2 border-b border-gray-700 pb-4 mb-4">
      <span>{t.language}:</span>
      <a href="/en" class="hover:text-white underline">English</a>
      <span>|</span>
      <a href="/es" class="hover:text-white underline">Español</a>
      <span>|</span>
      <a href="/fr" class="hover:text-white underline">Français</a>
    </div>
    <p>&copy; 2025 Martin Ferrero-Thompson. {t.rightsReserved}</p>
  </footer>
</aside>